<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FlightAlert Pro - Professional Flight Search Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e22ce 100%);
            min-height: 100vh;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
            padding: 40px 20px;
        }
        
        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            font-weight: 800;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            font-weight: 300;
        }
        
        .nav-bar {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .nav-btn {
            background: white;
            color: #1e3c72;
            border: none;
            padding: 12px 25px;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .nav-btn.active {
            background: #7e22ce;
            color: white;
        }
        
        .dashboard-card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            backdrop-filter: blur(10px);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .card-header h2 {
            font-size: 1.8rem;
            color: #1e3c72;
        }
        
        .search-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
        }
        
        .form-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #555;
            font-size: 0.9rem;
        }
        
        .form-group input, .form-group select {
            padding: 14px;
            border: 2px solid #e1e5e9;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            background: white;
        }
        
        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #7e22ce;
            box-shadow: 0 0 0 3px rgba(126, 34, 206, 0.1);
        }
        
        .search-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            border: none;
            padding: 16px 35px;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            grid-column: 1 / -1;
            max-width: 250px;
            justify-self: center;
            box-shadow: 0 5px 15px rgba(126, 34, 206, 0.3);
        }
        
        .search-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(126, 34, 206, 0.4);
        }
        
        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .stats-section {
            background: rgba(255,255,255,0.15);
            border-radius: 20px;
            padding: 35px;
            margin: 30px 0;
            color: white;
            text-align: center;
            backdrop-filter: blur(10px);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .stat-item {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(5px);
        }
        
        .stat-number {
            font-size: 2.8rem;
            font-weight: 800;
            display: block;
            margin-bottom: 8px;
            color: #fff;
        }
        
        .stat-label {
            font-size: 0.95rem;
            opacity: 0.95;
            font-weight: 500;
        }
        
        .pricing-section {
            margin: 40px 0;
        }
        
        .pricing-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }
        
        .pricing-card {
            background: white;
            border-radius: 20px;
            padding: 35px;
            text-align: center;
            position: relative;
            box-shadow: 0 10px 40px rgba(0,0,0,0.12);
            transition: all 0.3s;
        }
        
        .pricing-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(0,0,0,0.2);
        }
        
        .pricing-card.popular {
            border: 3px solid #7e22ce;
            transform: scale(1.05);
        }
        
        .popular-badge {
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #7e22ce, #5b21b6);
            color: white;
            padding: 6px 24px;
            border-radius: 25px;
            font-size: 0.85rem;
            font-weight: 700;
            box-shadow: 0 3px 10px rgba(126, 34, 206, 0.3);
        }
        
        .price {
            font-size: 3.5rem;
            font-weight: 800;
            color: #1e3c72;
            margin: 25px 0;
        }
        
        .price-currency {
            font-size: 1.8rem;
            vertical-align: top;
        }
        
        .price-period {
            font-size: 1.1rem;
            color: #666;
            font-weight: 400;
        }
        
        .subscribe-btn {
            background: linear-gradient(135deg, #1e3c72 0%, #7e22ce 100%);
            color: white;
            border: none;
            padding: 16px 35px;
            border-radius: 10px;
            font-size: 17px;
            font-weight: 700;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(126, 34, 206, 0.3);
        }
        
        .subscribe-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(126, 34, 206, 0.4);
        }
        
        .features-list {
            list-style: none;
            margin: 25px 0;
            text-align: left;
        }
        
        .features-list li {
            padding: 10px 0;
            position: relative;
            padding-left: 30px;
            color: #555;
        }
        
        .features-list li::before {
            content: '✓';
            position: absolute;
            left: 0;
            color: #7e22ce;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 40px;
        }
        
        .feature-card {
            background: white;
            border-radius: 18px;
            padding: 30px;
            text-align: center;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        
        .feature-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 40px rgba(0,0,0,0.15);
        }
        
        .feature-icon {
            font-size: 3rem;
            margin-bottom: 18px;
        }
        
        .feature-card h3 {
            margin-bottom: 12px;
            color: #1e3c72;
            font-size: 1.3rem;
        }
        
        .feature-card p {
            color: #666;
            line-height: 1.6;
        }
        
        .results-container {
            display: none;
            margin-top: 30px;
        }
        
        .flight-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 5px solid #7e22ce;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .flight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.12);
        }
        
        .flight-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .flight-price {
            font-size: 2rem;
            font-weight: 800;
            color: #7e22ce;
        }
        
        .flight-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 0.85rem;
            color: #888;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
        }
        
        .book-btn {
            background: #7e22ce;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .book-btn:hover {
            background: #6b21a8;
        }
        
        .rare-badge {
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }
        
        .live-map {
            height: 500px;
            background: #e0e7ff;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .map-placeholder {
            text-align: center;
            color: #666;
        }
        
        .aerospace-facts {
            background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
        }
        
        .fact-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #7e22ce;
        }
        
        .fact-title {
            font-weight: 700;
            color: #1e3c72;
            margin-bottom: 8px;
            font-size: 1.1rem;
        }
        
        .fact-content {
            color: #555;
            line-height: 1.6;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #7e22ce;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.2rem;
            }
            
            .search-form {
                grid-template-columns: 1fr;
            }
            
            .pricing-card.popular {
                transform: none;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .section {
            display: none;
        }
        
        .section.active {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>✈️ FlightAlert Pro</h1>
            <p>Professional Flight Search & Global Aviation Intelligence Platform</p>
        </div>
        
        <div class="nav-bar">
            <button class="nav-btn active" onclick="showSection('search')">🔍 Flight Search</button>
            <button class="nav-btn" onclick="showSection('map')">🌍 Live Map</button>
            <button class="nav-btn" onclick="showSection('rare')">✨ Rare Aircraft</button>
            <button class="nav-btn" onclick="showSection('facts')">📚 Aerospace Facts</button>
            <button class="nav-btn" onclick="showSection('pricing')">💳 Pricing</button>
        </div>
        
        <!-- Search Section -->
        <div id="search-section" class="section active">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Search Flights</h2>
                    <span style="color: #7e22ce; font-weight: 600;">Real-time flight data</span>
                </div>
                <form class="search-form" id="flightSearchForm">
                    <div class="form-group">
                        <label for="departure">From (IATA Code)</label>
                        <input type="text" id="departure" name="departure_iata" placeholder="LHR, JFK, etc." required maxlength="3">
                    </div>
                    <div class="form-group">
                        <label for="arrival">To (IATA Code)</label>
                        <input type="text" id="arrival" name="arrival_iata" placeholder="LAX, DXB, etc." required maxlength="3">
                    </div>
                    <div class="form-group">
                        <label for="depart_date">Departure Date</label>
                        <input type="date" id="depart_date" name="depart_date" required>
                    </div>
                    <div class="form-group">
                        <label for="passengers">Passengers</label>
                        <select id="passengers" name="passengers">
                            <option value="1">1 Passenger</option>
                            <option value="2">2 Passengers</option>
                            <option value="3">3 Passengers</option>
                            <option value="4">4 Passengers</option>
                            <option value="5">5 Passengers</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="cabin">Cabin Class</label>
                        <select id="cabin" name="cabin">
                            <option value="ECONOMY">Economy</option>
                            <option value="PREMIUM_ECONOMY">Premium Economy</option>
                            <option value="BUSINESS">Business</option>
                            <option value="FIRST">First Class</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="currency">Currency</label>
                        <select id="currency" name="currency">
                            <option value="GBP">GBP (£)</option>
                            <option value="USD">USD ($)</option>
                            <option value="EUR">EUR (€)</option>
                            <option value="JPY">JPY (¥)</option>
                            <option value="CAD">CAD ($)</option>
                            <option value="AUD">AUD ($)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="max_price">Max Price (optional)</label>
                        <input type="number" id="max_price" name="max_price" placeholder="500">
                    </div>
                    <div class="form-group">
                        <label for="rare_filter">
                            <input type="checkbox" id="rare_filter" name="rare_aircraft_filter" value="yes">
                            Only Rare Aircraft
                        </label>
                    </div>
                    <button type="submit" class="search-btn" id="searchBtn">Search Flights</button>
                </form>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 15px; color: #666;">Searching flights...</p>
                </div>
                
                <div class="results-container" id="resultsContainer"></div>
            </div>
        </div>
        
        <!-- Live Map Section -->
        <div id="map-section" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Live Global Flight Tracker</h2>
                    <button class="nav-btn" onclick="loadLiveMap()">🔄 Refresh</button>
                </div>
                <div class="live-map" id="liveMap">
                    <div class="map-placeholder">
                        <h3>🌍 Live Flight Tracker</h3>
                        <p>Tracking flights worldwide in real-time</p>
                        <button class="nav-btn" onclick="loadLiveMap()" style="margin-top: 15px;">Load Live Data</button>
                    </div>
                </div>
                <div id="flightMapData" style="margin-top: 20px;"></div>
            </div>
        </div>
        
        <!-- Rare Aircraft Section -->
        <div id="rare-section" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Rare & Special Aircraft</h2>
                    <span style="color: #7e22ce;">Track unique flying experiences</span>
                </div>
                <div id="rareAircraftList"></div>
            </div>
        </div>
        
        <!-- Aerospace Facts Section -->
        <div id="facts-section" class="section">
            <div class="dashboard-card">
                <div class="card-header">
                    <h2>Aerospace Facts & Calculations</h2>
                </div>
                <div class="aerospace-facts" id="aerospaceFacts"></div>
            </div>
        </div>
        
        <!-- Pricing Section -->
        <div id="pricing-section" class="section">
            <div class="stats-section">
                <h2>Live Flight Statistics</h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <span class="stat-number" id="stat-flights">25,847</span>
                        <span class="stat-label">Flights Tracked Today</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">£3.2M</span>
                        <span class="stat-label">Customer Savings</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">99.2%</span>
                        <span class="stat-label">Alert Accuracy</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">500+</span>
                        <span class="stat-label">Airlines Covered</span>
                    </div>
                </div>
            </div>
            
            <div class="pricing-section">
                <h2 style="text-align: center; color: white; margin-bottom: 15px; font-size: 2.5rem;">Choose Your Plan</h2>
                <p style="text-align: center; color: white; margin-bottom: 30px; font-size: 1.1rem;">Get unlimited access to real-time flight data and price alerts</p>
                <div class="pricing-cards">
                    <div class="pricing-card">
                        <h3>Monthly Pro</h3>
                        <div class="price">
                            <span class="price-currency">£</span>5
                            <span class="price-period">/month</span>
                        </div>
                        <ul class="features-list">
                            <li>Unlimited flight searches</li>
                            <li>Real-time price alerts</li>
                            <li>Deep airline booking links</li>
                            <li>Multi-currency support</li>
                            <li>Email notifications</li>
                            <li>Live flight tracking</li>
                        </ul>
                        <button class="subscribe-btn" onclick="subscribe('monthly')">Subscribe Monthly</button>
                    </div>
                    
                    <div class="pricing-card popular">
                        <div class="popular-badge">⭐ BEST VALUE</div>
                        <h3>Lifetime Pro</h3>
                        <div class="price">
                            <span class="price-currency">£</span>70
                            <span class="price-period">once</span>
                        </div>
                        <ul class="features-list">
                            <li>Everything in Monthly</li>
                            <li>Rare aircraft alerts</li>
                            <li>Priority customer support</li>
                            <li>Advanced analytics dashboard</li>
                            <li>API access (coming soon)</li>
                            <li>Aerospace facts database</li>
                            <li><strong>No recurring fees ever</strong></li>
                        </ul>
                        <button class="subscribe-btn" onclick="subscribe('lifetime')">Get Lifetime Access</button>
                    </div>
                </div>
                
                <div style="text-align: center; color: white; margin-top: 30px; padding: 20px; background: rgba(255,255,255,0.1); border-radius: 15px;">
                    <p style="font-size: 0.95rem; opacity: 0.9;">💳 Secure payment processing by Stripe</p>
                    <p style="font-size: 0.85rem; opacity: 0.8; margin-top: 5px;">All payments are test mode. For production, configure STRIPE_SECRET_KEY and STRIPE_PUBLISHABLE_KEY in environment.</p>
                </div>
            </div>
        </div>
        
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">🔍</div>
                <h3>Smart Search</h3>
                <p>Advanced flight search with real-time pricing across 500+ airlines worldwide</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💰</div>
                <h3>Price Monitoring</h3>
                <p>Automatic price tracking and instant alerts when prices drop below your target</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🔗</div>
                <h3>Direct Booking</h3>
                <p>Real airline deep links for seamless booking on official airline websites</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">✈️</div>
                <h3>Rare Aircraft</h3>
                <p>Track flights on rare aircraft including A380, 747-8, Concorde routes and more</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">🌍</div>
                <h3>Global Coverage</h3>
                <p>Live tracking of flights worldwide with comprehensive airport database</p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">💱</div>
                <h3>Multi-Currency</h3>
                <p>Automatic currency conversion with live exchange rates for 11+ currencies</p>
            </div>
        </div>
    </div>
    
    <script>
        // Set default departure date to tomorrow
        document.addEventListener('DOMContentLoaded', function() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            document.getElementById('depart_date').value = tomorrow.toISOString().split('T')[0];
            
            // Load aerospace facts on page load
            loadAerospaceFacts();
            loadRareAircraft();
        });
        
        // Section navigation
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            
            // Show selected section
            document.getElementById(sectionName + '-section').classList.add('active');
            event.target.classList.add('active');
        }
        
        // Handle flight search form
        document.getElementById('flightSearchForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const searchData = Object.fromEntries(formData.entries());
            
            // Convert form data to proper types
            searchData.passengers = parseInt(searchData.passengers);
            if (searchData.max_price) searchData.max_price = parseFloat(searchData.max_price);
            if (searchData.rare_aircraft_filter) {
                searchData.rare_aircraft_filter = 'yes';
            } else {
                delete searchData.rare_aircraft_filter;
            }
            
            // Show loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            document.getElementById('searchBtn').disabled = true;
            
            try {
                const response = await fetch('/api/query', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(searchData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    displayResults(result);
                } else {
                    alert(`Error: ${result.detail || 'Search failed'}`);
                }
            } catch (error) {
                alert('Error submitting search. Please try again.');
                console.error('Search error:', error);
            } finally {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('searchBtn').disabled = false;
            }
        });
        
        function displayResults(data) {
            const container = document.getElementById('resultsContainer');
            container.innerHTML = '';
            
            if (!data.results || data.results.count === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666; padding: 40px;">No flights found. Try adjusting your search criteria.</p>';
                container.style.display = 'block';
                return;
            }
            
            // Add statistics
            if (data.statistics) {
                const statsHtml = `
                    <div style="background: linear-gradient(135deg, #e0f2fe 0%, #ddd6fe 100%); padding: 20px; border-radius: 12px; margin-bottom: 25px;">
                        <h3 style="color: #1e3c72; margin-bottom: 15px;">Search Results</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px;">
                            <div>
                                <div style="font-size: 0.85rem; color: #666;">Total Results</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #7e22ce;">${data.statistics.total_results}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666;">Average Price</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #7e22ce;">£${data.statistics.average_price}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.85rem; color: #666;">Best Price</div>
                                <div style="font-size: 1.5rem; font-weight: 700; color: #10b981;">£${data.statistics.min_price}</div>
                            </div>
                        </div>
                    </div>
                `;
                container.innerHTML += statsHtml;
            }
            
            // Add aerospace fact if available
            if (data.aerospace_fact) {
                const fact = data.aerospace_fact;
                container.innerHTML += `
                    <div class="fact-card" style="margin-bottom: 25px;">
                        <div class="fact-title">🚀 ${fact.title}</div>
                        <div class="fact-content">
                            <strong>Fact:</strong> ${fact.fact}<br>
                            <strong>Formula:</strong> ${fact.calculation || fact.formula || 'N/A'}<br>
                            <strong>Example:</strong> ${fact.example}
                        </div>
                    </div>
                `;
            }
            
            // Add flights
            data.results.flights.forEach(flight => {
                const flightHtml = `
                    <div class="flight-card">
                        <div class="flight-header">
                            <div>
                                <h3 style="color: #1e3c72; margin-bottom: 5px;">${flight.airline_display || flight.airline_code}</h3>
                                <p style="color: #666;">Flight ${flight.flight_number}</p>
                                ${flight.is_rare_aircraft ? '<span class="rare-badge">⭐ Rare Aircraft</span>' : ''}
                            </div>
                            <div class="flight-price">£${flight.price_converted || flight.price}</div>
                        </div>
                        <div class="flight-details">
                            <div class="detail-item">
                                <div class="detail-label">Route</div>
                                <div class="detail-value">${flight.departure} → ${flight.arrival}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Departure</div>
                                <div class="detail-value">${formatTime(flight.departure_time)}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Aircraft</div>
                                <div class="detail-value">${flight.aircraft || 'N/A'}</div>
                            </div>
                            <div class="detail-item">
                                <div class="detail-label">Duration</div>
                                <div class="detail-value">${formatDuration(flight.duration_minutes)}</div>
                            </div>
                        </div>
                        <button class="book-btn" onclick="bookFlight('${flight.booking_url}')">Book Now →</button>
                    </div>
                `;
                container.innerHTML += flightHtml;
            });
            
            container.style.display = 'block';
        }
        
        function formatTime(isoString) {
            const date = new Date(isoString);
            return date.toLocaleTimeString('en-GB', { hour: '2-digit', minute: '2-digit' });
        }
        
        function formatDuration(minutes) {
            const hours = Math.floor(minutes / 60);
            const mins = minutes % 60;
            return `${hours}h ${mins}m`;
        }
        
        function bookFlight(url) {
            if (url && url !== '#') {
                window.open(url, '_blank');
            } else {
                alert('Booking link not available. Please search on the airline website directly.');
            }
        }
        
        // Handle subscription
        async function subscribe(type) {
            try {
                const response = await fetch('/api/pay/session', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ product: type })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    alert(`Payment session created! Session ID: ${result.sessionId}\n\nIn production, you would be redirected to Stripe checkout.\n\nFor live payments, set:\n- STRIPE_SECRET_KEY\n- STRIPE_PUBLISHABLE_KEY\n- STRIPE_WEBHOOK_SECRET`);
                } else {
                    alert(`Error: ${result.error || 'Payment setup failed'}`);
                }
            } catch (error) {
                alert('Error setting up payment. Please try again.');
                console.error('Payment error:', error);
            }
        }
        
        // Load live map data
        async function loadLiveMap() {
            const mapContainer = document.getElementById('flightMapData');
            mapContainer.innerHTML = '<div class="loading"><div class="spinner"></div><p>Loading live flight data...</p></div>';
            
            try {
                const response = await fetch('/api/flights/live-map');
                const data = await response.json();
                
                let html = '<h3 style="color: #1e3c72; margin: 20px 0;">Currently Tracking ' + data.count + ' Flights</h3>';
                html += '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">';
                
                data.flights.slice(0, 20).forEach(flight => {
                    html += `
                        <div style="background: white; padding: 15px; border-radius: 10px; border-left: 3px solid #7e22ce;">
                            <div style="font-weight: 700; color: #1e3c72; margin-bottom: 5px;">${flight.id}</div>
                            <div style="font-size: 0.9rem; color: #666;">${flight.airline_name}</div>
                            <div style="font-size: 0.85rem; color: #888; margin-top: 8px;">
                                ${flight.origin} → ${flight.destination}<br>
                                Alt: ${flight.altitude.toLocaleString()} ft<br>
                                Speed: ${flight.speed} kts<br>
                                Status: <span style="color: #10b981;">${flight.status}</span>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                mapContainer.innerHTML = html;
            } catch (error) {
                mapContainer.innerHTML = '<p style="color: #666; text-align: center;">Error loading flight data</p>';
            }
        }
        
        // Load aerospace facts
        async function loadAerospaceFacts() {
            try {
                const response = await fetch('/api/aerospace-facts');
                const data = await response.json();
                
                const container = document.getElementById('aerospaceFacts');
                let html = '';
                
                data.facts.forEach(fact => {
                    html += `
                        <div class="fact-card">
                            <div style="background: #7e22ce; color: white; padding: 5px 12px; border-radius: 15px; display: inline-block; font-size: 0.85rem; margin-bottom: 10px;">
                                ${fact.category}
                            </div>
                            <div class="fact-title">${fact.title}</div>
                            <div class="fact-content">
                                <p><strong>Fact:</strong> ${fact.fact}</p>
                                <p><strong>Formula:</strong> <code style="background: #e0e7ff; padding: 3px 8px; border-radius: 5px;">${fact.formula}</code></p>
                                <p><strong>Example:</strong> ${fact.example}</p>
                            </div>
                        </div>
                    `;
                });
                
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading aerospace facts:', error);
            }
        }
        
        // Load rare aircraft
        async function loadRareAircraft() {
            try {
                const response = await fetch('/api/flights/rare');
                const data = await response.json();
                
                const container = document.getElementById('rareAircraftList');
                let html = '<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 20px;">';
                
                data.rare_aircraft.forEach(aircraft => {
                    html += `
                        <div style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); padding: 20px; border-radius: 15px; border: 2px solid #fbbf24;">
                            <div style="font-size: 2rem; margin-bottom: 10px;">✨</div>
                            <h3 style="color: #92400e; margin-bottom: 8px;">${aircraft.code}</h3>
                            <p style="color: #78350f; font-weight: 600;">${aircraft.manufacturer}</p>
                            <p style="color: #92400e; margin-top: 5px;">${aircraft.model}</p>
                            <div style="margin-top: 12px; background: white; padding: 8px; border-radius: 8px;">
                                <span style="color: #78350f; font-size: 0.85rem;">Popularity Score</span>
                                <div style="background: #fbbf24; height: 8px; border-radius: 4px; margin-top: 5px; width: ${aircraft.popularity_score}%;"></div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading rare aircraft:', error);
            }
        }
        
        // Animate live stats
        setInterval(() => {
            const flightsStat = document.getElementById('stat-flights');
            if (flightsStat) {
                const current = parseInt(flightsStat.textContent.replace(/,/g, ''));
                const increment = Math.floor(Math.random() * 15) + 5;
                flightsStat.textContent = (current + increment).toLocaleString();
            }
        }, 8000);
    </script>
</body>
</html>
